FROM python:3.13-slim

# Install dependencies
WORKDIR /tmp
# Install build dependencies for packages that don't have wheels for this python version
RUN apt-get update && apt-get install -y \
    build-essential \
    gcc \
    && rm -rf /var/lib/apt/lists/*

COPY requirements.txt ./
RUN pip install --no-cache-dir --upgrade -r requirements.txt \
    && rm -rf requirements.txt

# Copy source code
WORKDIR /app
# Copy current directory contents into vllm_router subdirectory to match package name expected by imports
COPY . vllm_router/

# Set PYTHONPATH so python can find the vllm_router package
ENV PYTHONPATH=/app

# Copy git revision file (generated by build-image.sh)
COPY --chmod=664 .GIT_REV /etc/

# Default entrypoint
ENTRYPOINT ["python3", "-m", "vllm_router.app"]
